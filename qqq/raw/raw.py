#!/usr/bin/env python
# -*- coding: utf-8 -*-
#日本語　あああ防伪标志
import codecs
import binascii
import struct
import array
from PIL import Image
data=b'7b014f54656368205300312e312e310000004f546563683435305f30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001000100020000000000706f72743000000000000000000000000000a0400000e1430000803f0000f041000020420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020101000100020000000000737464000000000000000000000000000000a0400000e1430000803f0000f0410000204200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cefa000002000000000040140000e7070810141927080000000000000400000000803b44000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000704100000000000000000ad7a33c0ad7a33d0000c2010000000000000000000000000000b00400000000000000000000000000000000000000001500290058005e0057002d0019005000360020002400490012004d0082004a00320053003000130040003f0046007b003c006a005f001f002b0037002700460037002c0074004700580071005500460023002c004e0038003600720068009c00a4006b004b003e0033002c008600b100c700aa007f008e00500029002d007400dc00dc005401e0009a00580097007f00f400c200a9009e003300b3007d0014003200be008101a001c0003d003c00a500ae00e600cb015803b503270041041a034b0078002500410021005e0081004700d7004f013f01ee007e00620069005d00e200830046008b00230087008c00b8006f0069006200b100c50045000b014e01570080005b003000d800a2004a004b00530067007300700066000a007c007a003a004a0028006c0053000f0119010101f500d90044008800b0005901c301d60056005900ec00ce010002ea017601bc005c019e016c017400c80054010602a70197018a026b02da016a01ad00a40184015d00b801f4022803f7010001f3004d0197020d035d02590291005200f000f300c7004b01b2018e01470149000f011101da008e01a5026e0272016601de0112028502c3031704570302038502e0001503fc043e020e014e001902f502fb06c705cd04bf06fe05a8050c0667047601a600ac007d0043008a00510051003c00ac006e009e00b600ab005e000e003a002f0030005a00a400a0003d00af0026004a004c00a300d1002401e3002e0028007b00930062006100be00ec008c005b0081007b00440070005d0098006d008f00b80062004f00c900d900a2007100ba00ea001c012501de0019008e00970065003b0024007b00b70059009900a8006600ba00d800530051003d004c007c0016011d019100920006017b0189014d018d000c0069009b009700d200da00d5005100d3004c01bc006f00cc0060005c004a001d014801bd008a0042007a0037008300c5004c00af007b000400a1003201cf002700bd0070002f01dc005f00450073005500710046006600d300bb0045007a007100620073008d00ab0027012301ac006d002400650050004000a80077001d00070047001d00e600120171006d00aa000201c80079008b0090005a008500d600d9006f00520047005500b800d100ac00c000dd00d60089003f00d700f30047005301e301d9012f01980099006d008c00dc005b001c01b9005f00500018005200d9008f003f000e01ea006e015002cc01b400f400b800f601a0013d038e02420230030e040203f900bd019901ea0148028c00c7006501a100a101e701e301ea004b00ea000d01f2009a00a3009b00e00062007501be0162015d010601b5000101c1003101d9016a01df00a401ad01400162005e008800e9003201bc003d02ee0251021d01b900ab00d800950002018200cb01f20081009900ec000201f6009401fa017c024c028f019400f6021b035a011d00e5009d019504ec038301a4005d01620229034e0412036f0126013c010103d7043e047f0275021703b803cd04f6034d02da008400d3007b01ed0122012802480220027f027c049205a4044504d3039101c101ff02e0021a0352034602f903ad03970076028502ec027105d2044d048b026805ff0104045c03cd03a403fa08e80b8b0e250aae040703fd024e03be0206034c047805ba042607a50a0408c701dd00a201ef01260018024c01b0000c010a01d4000a02aa01d2009700d50054004b01bd014e011b01ea00c800fd00620169019e00a70035017400060106024d02df00c1006300fa00aa00a0003101ea00b100ee00580158018a01ec0062001f01ac009b00dd0067005901650147016c014a015f004600b90016013600e101de010e01790068001e006a009900c000ab00480133021a02f0002d005700640082007501e401c3018901d4019e01c9017f03ac029f014a01de01760245016a012f011501ab00900040013d016a0090001c01510147017c0123016c00a400fd0027013b01bc004e006c014d02a1017c0056007f005b00280143013e000202ac02f902e501d700b40241037301e402b0035302ea02d1041905e5056a08f2085705bb03a305ea051406940b0c09350221037902ef01e6019b019d01000287020601190091010501b102e403cd027902bc022301bc027902ef008a02d001aa017b011f01f401b7035402ac01850486056e035005cd09c20a70030c0309038702cf0000015f034e0218014201e001f4024d0355005b043c049601a3020601af018c030604470250031005dc07250bb6089c04b90656021f06d6052704a8041b04e4067e09d00ccc0a58072805a3029002d501c1033603e7027804ce09dd0896079808690cfb10840df9065d083f0c9a0e4704cf029402f501ab0044011a0132007600b900390142014a01ec003a018300100118014b002c01b8016100d9012901720016019001580073011001390042010302480268028e01c0031205b20348028c016101f501b101bf00a1004d01d9016901ea018902c40034029503b0029a001a026802c50137033506260597030504e0022d029c020c037f02bc0141000c013602b50257025d00c001e2031803f800d30190026602b1022802da0079011f02cb015102da03e1047b02ce05c00af407c7022202f2003601c800d800a70078014502f8007c01d901d6012001fb0015027801340254035101f30011025c038a01af013901ec036805a4045c02a3004e01610182015c027602ad01d0007501900056001801fd00da00bf0391021d017b026a03ae042504b20106020f03fe02cb01b8018e026c03af023e0258027201ef005c01c301d5019402ab02dc025a0292023303ed01fb008d035c048402970149015f01d4022802ce00890216037c01bf006801f301ca009f01100150017c02b4034b0306021f015e01db001a022d001a029202f9017e004e015c01f201fd0489063102f401e6027701dc00aa011e0208029a03580478047f051005b50162001d02ed027b009b01240217039305f30626054d02c200700173019800dc00ee00a20193019500560171028905c303040250033404c603ac05ef04c5040e064a0744015b045e02b60092007f01e301f6002102a8022c03ba013501c102aa040006bd03b200a5012e0357040b04f401e3019601680375041f0506050203f0017701f501c602de018c006c009f00b000cd00eb00f4002001b3007500b600d1008400a400ba00ef0012000f0182003a01ce05f406640261003701480128013e0105010101c3000d01c400e500fd013602e101460188007900b900c800fd000901f6005a0071007e0031007c00460066001f0038009a01ea068307010004000000704100000000000000000ad7a33c0ad7a33d0000c2010000000000000000000000000000b004000000000000000000000000000000000000000064069807c002ca0095004a006b0025006f005f006000a4005000a0008f00b40076007700ab001f013701b40046040f06fe039c01cd0151019200c70074008f00bf00d60084001d0215050e056c02c4001b01700230020502fc0198011c012c013901fb0067008c007f00cb00d000ca00c400cd0119028b01100b74089701e8032a0652053a052a04dd01dc033603ae037e055d04b700530222041d036d022f02720172024b0265013900be005401f5015c02de024603ae037d072308e6064708ff042d02e600a3017d0143014b018900aa01cc017800e10180018501ba0133028201a201e70024017301aa002f00d400aa0169046a062602bd048607940607052604f10258049005c0064b061e063304da012d05460384005902d202f1018d01c3003103d405f403c801ec011a023a005c032e05220244011b01f500fe01fd001e0208033e042b040e02c600ba00be0036014a018d01e70178014f005001ee02eb03af02c2005900c8005c014801c601ed0240022c016902a7026002c9012f013d009d0051017e02f3018d0123020f0277023f029a010903c2004a01a401d8017901f80043008b01db010502fd017501f8008c0230032b021c02be00ae00b300b000aa07290f870e9609770424030a085108a005c003e407090b12088003550608098309d30c85097c056504e30aaf0a6c0965062b0233025003b803fd014d05850b7508e809f70a66042f011201fd02da012e02eb028602ff0226024a02e2034c0215015200b801c4016d05350c510a3603e103a7043a042b02e30279058d06f1041d0428033501e301d20382027101a401c70136015c0005030406f103780095012e025b0243018101b0024d02f5014e02ea01ec01bd02c1015b017b0261011c0188018601ec00bf00bd0056006f002e018e01e000530090007000090205020a015600c000e30030018001ed01390176000f013b013602700088011700b7014802fa014100e000860096007600ec086a0e280f5111da06dd000402290368016b015604120831062202e0029f03f0023e044c024100140111028f024c0266019c01840208021d0227013b017a01e10010013101fd001a03f901180149013e020d025601a201c604ec087107c3056809b1082d04ea022d03d1033505f8033402e603620288019d01490134015001230132004e00f001430216011e013e01e701a000b701e701e500750023001c007200ac00f600d700d6002a017a016d003d02b2024801400051011d01ba00420111018200f4007400c8009400a600e002fa05df03f4008702d8013101d00052010601ef00870029014b01400151002f00b3005f008301b601c70088003a00be00c6005b00cc003e006600dd004d03a4042103e3007f002c0198006901a5023401a801710281019d01a8027a04ec04b2035a02c700c6003a01ec011a027701a3012a0210018f0050013e017300de00cc0081008700740105029f01d900e800fc0048012701ba009b00ac002e01b401e801de01a000ff00df006400bc006c00da000401e500be001701aa003400890044016301c10060001b015a0188010401900092024205cb03e601990177017b00a0013501a6004a008000a7004f00ed002b0130019f01df00c500c6007601500145010c010e0032021d03990317065303680344013f013602e0023c022a02680189023e06f40a490975042705d7020604c90622043e046f01e100ac013e01d4007700120204047102a1004f02e8019c00a000e70072000702fa034d04b3018002a903a7049c049a0364027c018601b40175013601cd000803dc024d013101c200e102f8019202b804570361009a03bd03a00271017d01dd00ae02d2034c02ad00aa00bb025a03af029a038f012e01c10002029602aa027e0167015e01ca00e801ef0130011802e3018402b5019e004901d9012001ab00ea00760062009b005700a201b801fb00bb0079013101f400ce00b300a3005d00fc006a01d0005c00770071002a00a200c800b900a000b2009800bb01410161017f01d1003b0063001902b402b7002302a501cd014e01ff003501a001af000201d2010902c602b0019d00a8002b00bf00a400fd0017010401d4010f0264004300c500fe00f900e600c700c800d8009e007600aa0091006900630042000f00a80045013201c800cc009d00a200810011012b014a003f00ef00da01a2019b00cb004101da005a003f00480095001a011101f600e10053001e007700c800b600ba00ef003e004100e300e8006d008f008d009200c500730047003d00940099006a00a400ac00d400d8001901350129015901c8009100ea004200df00330125010501a600ab019e04c5042c035f0406046b039402150309036f0023014c01780272036d047c05d903c6037503b802ae0252038d0248015901ff004800a8010502ad0198007d02a60229034702e9003701fe01ab028c01ac0157020a039e04ae046e035801070230022c016900dd019702920176014802780123012a02d701ab00a1012c02c500bc00db006e008d00a201de018b006200bf002901be005a003a00ac00360109014f01b6005c0020015c01d20066000201a7001400c900c20112013e00b300850041007a008f005000580070008300db00a300b50084009d0062003d001e0058006b00a2007b008800fe002e017e00360070006900c0000d01ef00a3004b002000420089007f0027004400cc00d3004e00ba002c01e500a400f0002500bc00730084001d017f000301bb012d011a013b0169016801dd01e9016a01800179013e0130014301360118013a013101080177014301a80082005f006b00db0016019e005e0068004200200138013e013e019b01a2021202e200d900a2001e015101ac005f011f01b90028011f01640017007a007e00a10049018701fe00be00ab009e004d002f006300830038007400dc00d30033007800880047009d00cb007a005700680088007d005e009900850050003f0045009d00a3006500380061004e00a6004f0075006b00370071005000390051006900700052004e0077007a0056008c007400230021002e005100310045009f00a50097007a0080006a003c00480045005e00de00c400510023005000230056005800240013003b0009003c008f009a0040003b009800c30075003500550088005d00290048004b003300180044004e0066003000610097007f007d008e00760079004c00180025000f006c008e00ff008a014901b10078009a0007011001ca0063002c005a00320041007b005d006300460035003c0011002600550057004d00120028001c0041000d00260061007c007b006e002c001c003200'
xtf_header=data[:2048]#预处理数据的帧头和xtf数据的帧头是一样的
xtf_header_file=xtf_header[0:2]#开头一般都是7b
xtf_header_system=xtf_header[2:4]#系统类型，一般设置为1
xtf_header_ProgramName=xtf_header[4:20]#这段字符是程序名字，把这一段从16进制转为string类型
Name1=int(xtf_header_ProgramName,16)
Name2=hex(Name1)[2:]
Name3=binascii.unhexlify(Name2).decode()#把名字的16进制流转换成字符串并显示,后面流程相同
print('ProgramName:'+Name3)
xtf_header_PR=xtf_header[20:36]#记录程序版本号
Version1=int(xtf_header_PR,16)
Version2=hex(Version1)[2:]
Version3=binascii.unhexlify(Version2).decode()
print('Version:'+Version3)
xtf_header_Sonar=xtf_header[36:68]#记录声呐名称
Sonar1=int(xtf_header_Sonar,16)
Sonar2=hex(Sonar1)[2:]
Sonar3=binascii.unhexlify(Sonar2).decode()
print('Sonar Name:'+Sonar3)
xtf_WordSonarType=xtf_header[68:72]#一个我也不知道什么意思的字段，根据解析结果查表可得到对应的类型,我们的声呐一般都是默认为0
Word1=str(int(xtf_WordSonarType,16))
print('WordSonarType:'+Word1)
xtf_NoteString=xtf_header[72:200]#相当于一个备忘录内容,但是这里全都是0，所以这里不做进一步的解析了
Notestring1=int(xtf_NoteString,16)
if Notestring1==0:#判断是否为0，为0就会报错
    print("Note:There is no memory")
else:
    Notestring2=hex(Notestring1)[2:]
    Notestring3=binascii.unhexlify(Notestring2).decode()
    print('Note:'+xtf_NoteString)
xtf_FileName=xtf_header[200:328]#xtf文件名，不知道这里为什么会有超出范围无法解析的
#print(xtf_FileName)
FileName1=int(xtf_FileName,16)
if FileName1!=0:
    FileName2=hex(FileName1)[2:]
    FileName3=binascii.unhexlify(FileName2).decode('utf-8','ignore')
    print("file name:"+FileName3)
xtf_NavUnits=xtf_header[328:332]#航行单位，这里开始小段存储了，需要颠倒一下位置
Nav1=xtf_NavUnits[0:2]
Nav2=xtf_NavUnits[2:4]
Nav3=int((Nav2+Nav1),16)
if Nav3==0:
    print('NavUnits:Metres')
if Nav3==3:
    print('NavUnits:Lat/Long')
xtf_SonarChannel=xtf_header[332:336]#我们的声呐一共有几个通道，如果大于6个通道则header要延长
Channel=int((xtf_SonarChannel[2:4]+xtf_SonarChannel[0:2]),16)
Channel1=str(Channel)
print('Channel Number:'+Channel1)
if Channel>6:
    xtf_header=xtf_header+data[2048:4096]
xtf_BathChannel=xtf_header[336:340]
#print(xtf_BathChannel)
BathChannel=int((xtf_BathChannel[2:4]+xtf_BathChannel[0:2]),16)
BathChannel1=str(BathChannel)
print('BathymetryChannels Nmuber:'+BathChannel1)#下面的具体功能暂时先不实现，先把这些字段拆分保留
xtf_SnippetChannel=xtf_header[340:342]

xtf_FowardLookArrays=xtf_header[342:344]

xtf_ESC=xtf_header[344:348]

xtf_IC=xtf_header[348:350]

xtf_R1=xtf_header[350:352]
xtf_R2=xtf_header[352:356]

xtf_PointHeight=xtf_header[356:364]
#print(xtf_PointHeight)

xtf_ProjectionType=xtf_header[364:388]
xtf_SpheriodType=xtf_header[388:408]
xtf_NL=xtf_header[408:416]
#print(xtf_NL)
xtf_OriginY=xtf_header[416:424]
xtf_OriginX=xtf_header[424:432]
xtf_NavOffsetY=xtf_header[432:440]
#print(xtf_NavOffsetY)
xtf_NavOffsetX=xtf_header[440:448]
xtf_NavOffsetZ=xtf_header[448:456]
xtf_NavOffsetYaw=xtf_header[456:464]
xtf_MRUOOffsetY=xtf_header[464:472]
xtf_MRUOOffsetX=xtf_header[472:480]
xtf_MRUOOffsetZ=xtf_header[480:488]
xtf_MRUOOffsetYaw=xtf_header[488:496]
xtf_MRUOOffsetOffsetPitch=xtf_header[496:504]
xtf_MRUOOffsetOffsetRoll=xtf_header[504:512]
#这里开始解析的是每个通道的数据
data_channel1=xtf_header[512:768]
data_channel2=xtf_header[768:1024]
data_channel3=xtf_header[1024:1280]
data_channel4=xtf_header[1280:1536]
data_channel5=xtf_header[1536:1792]
data_channel6=xtf_header[1792:2048]
#因为只有两个通道 3-6的数据都为0,这里还是把所有的都拆分出来
#从下面开始解析通道1
Channel1_Type=int(data_channel1[0:2],16)
if Channel1_Type==1:
    print('channel1Type: PORT')
if Channel1_Type==0:
    print('channel1Type: SUBBOTTOM')
if Channel1_Type==2:
     print('channel1Type: STBD')
if Channel1_Type==3:
     print('channel1Type: BATHYMETRY')
Channel1_SubChannelNumber=int(data_channel1[2:4])
Channel1_Flag=data_channel1[4:8]#1=以倾斜距离存储的声纳图像，2=以地面距离存储的声纳图像(校正后)
Flag=int((Channel1_Flag[2:4]+Channel1_Flag[0:2]),16)
if Flag==1:
    print("channel1flag: sonar imagery stored as slant-range")
if Flag==2:
    print("channel1flag:sonar imagery stored as ground range ")
Channel1_UniPolar=data_channel1[8:12]#0=data为极性，1=data为单极性
Polar=int((Channel1_UniPolar[2:4]+Channel1_UniPolar[0:2]),16)
if Polar==0:
    print("channel1's data is polar")
if Polar==1:
    print("channel1's data is unpolar")
Channel1_BytesPerSample=data_channel1[12:16]
BytesPerSample=int((Channel1_BytesPerSample[2:4]+Channel1_BytesPerSample[0:2]),16)
if BytesPerSample==1:
    print("channel1 8-bit data")
if BytesPerSample==2:
    print("channel1 16-bit data")
if BytesPerSample==4:
    print("channel1 32-bit data")
Channel_Reserved=data_channel1[16:24]
Channel_Name=data_channel1[24:56]
CName1=int(Channel_Name,16)
CName2=hex(CName1)[2:]
CName3=binascii.unhexlify(CName2).decode()
print('Channel1Name:'+CName3)
Channel_Volt=str(data_channel1[56:64])
Volt1=Channel_Volt[2:-1]
Volt2=bytes.fromhex(Volt1)
Volt3=struct.unpack('f',Volt2)[0]
Volt4='{:.4f}'.format(Volt3)
print(Volt4)
Channel1_Fre=str(data_channel1[64:72])
Fre1=Channel1_Fre[2:-1]
Fre2=bytes.fromhex(Fre1)
Fre3=struct.unpack('f',Fre2)[0]
Fre4=str('{:.4f}'.format(Fre3))
print('Channel1 Center transmit frequency: '+Fre4)
Channel1_Ang=str(data_channel1[72:80])
Ang1=Channel1_Ang[2:-1]
Ang2=bytes.fromhex(Ang1)
Ang3=struct.unpack('f',Ang2)[0]
Ang4=str('{:.4f}'.format(Ang3))
print('Channel1 HorizonBeamAngle: '+Ang4)
Channel1_tAng=str(data_channel1[80:88])
tAng1=Channel1_tAng[2:-1]
tAng2=bytes.fromhex(tAng1)
tAng3=struct.unpack('f',tAng2)[0]
tAng4=str('{:.4f}'.format(tAng3))
print('Channel1 TiltAngle: '+tAng4)#这些都是默认值，这个数据中有很多xtf字段没有用到
Channel1_BeamWidth=str(data_channel1[88:96])#波束宽度
#print(Channel1_BeamWidth)
BeamWidth1=Channel1_BeamWidth[2:-1]
BeamWidth2=bytes.fromhex(BeamWidth1)
BeamWidth3=struct.unpack('f',BeamWidth2)[0]
BeamWidth4=str('{:.4f}'.format(BeamWidth3))
print('Channel1 BeamWidth: '+BeamWidth4)
Channel1_OffsetX=str(data_channel1[96:104])
Channel1_OffsetY=str(data_channel1[104:112])
Channel1_OffsetZ=str(data_channel1[112:120])
Channel1_OffsetYaw=str(data_channel1[120:128])
Channel1_OffsetPitch=str(data_channel1[128:136])
Channel1_OffsetRoll=str(data_channel1[136:144])
Channel1_BeamPerArray=data_channel1[144:148]
Channel1_SampleFormat=data_channel1[148:150]
Channel1_ReservedArea=data_channel1[150:256]
#print(Channel1_ReservedArea)
print(len(data))


#从下面开始解析帧头
xtf_pingheader=data[2048:2560]#提取帧头
pingheader_MagicNum=xtf_pingheader[0:4]#pingheader的标志位，这里也是倒序存储
pingheader_HeaderType=xtf_pingheader[4:6]#标明是哪种类型的数据，这里的数据是0，表示下面存储的数据属于声呐数据
#print(xtf_pingheader)
pingheader_SubCN=xtf_pingheader[6:8]#bathmetry才需要用到的字段
pingheader_NumChan=xtf_pingheader[8:12]#标明声呐有几个通道
NumChan1=int((pingheader_NumChan[2:4]+pingheader_NumChan[0:2]),16)
NumChan2=str(NumChan1)
print('Sonar Channel Number:'+NumChan2)
#print(pingheader_NumChan)
pingheader_Reserved=xtf_pingheader[12:20]
pingheader_NumBytes=xtf_pingheader[20:28]
NumBytes1=int((pingheader_NumBytes[6:8]+pingheader_NumBytes[4:6]+pingheader_NumBytes[2:4]+pingheader_NumBytes[0:2]),16)
NumBytes2=str(NumBytes1)
print('Total data bytes: '+NumBytes2)
Year=xtf_pingheader[28:32]
Year1=int(Year[2:4]+Year[0:2],16)
Year2=str(Year1)
Month=xtf_pingheader[32:34]
Month1=str(int(Month,16))
Day=xtf_pingheader[34:36]
Day1=str(int(Day,16))
Hour=xtf_pingheader[36:38]
Hour1=str(int(Hour,16))
Minute=xtf_pingheader[38:40]
Minute1=str(int(Minute,16))
Second=xtf_pingheader[40:42]
Second1=str(int(Second,16))
HSecond=xtf_pingheader[42:44]
HSecond1=str(int(HSecond,16))
print('Time: '+Year2+'-'+Month1+'-'+Day1+' '+Hour1+':'+Minute1+':'+Second1+':'+HSecond1)
pingheader_EventNum=xtf_pingheader[48:56]
pingheader_PingNUm=xtf_pingheader[56:64]
PingNum=str(int((pingheader_PingNUm[6:8]+pingheader_PingNUm[4:6]+pingheader_PingNUm[2:4]+pingheader_PingNUm[0:2]),16))
print('Ping Number: '+PingNum)
#这里列出部分字段，但是这里的声呐都没有用到，所以不在这里浪费时间进行切分
pingheader_SoundV=xtf_pingheader[64:72]#声速，太大了，先搁置
pingheader_OceanT=xtf_pingheader[72:80]
pingheader_Reser=xtf_pingheader[80:88]
pingheader_ConFre=xtf_pingheader[88:96]
pingheader_TemPre=xtf_pingheader[96:104]
pingheader_PreFre=xtf_pingheader[104:112]
pingheader_PreTemp=xtf_pingheader[112:120]
pingheader_Conduc=xtf_pingheader[120:128]
pingheader_WaterTem=xtf_pingheader[128:136]
pingheader_Pressure=xtf_pingheader[136:144]
pingheader_ComSV=xtf_pingheader[144:152]
pingheader_MagX=xtf_pingheader[152:160]
pingheader_MagY=xtf_pingheader[160:168]
pingheader_MagZ=xtf_pingheader[168:176]
pingheader_AuvVal1=xtf_pingheader[176:184]
pingheader_AuvVal2=xtf_pingheader[184:192]
pingheader_AuvVal3=xtf_pingheader[192:200]
pingheader_AuvVal4=xtf_pingheader[200:208]
pingheader_AuvVal5=xtf_pingheader[208:216]
pingheader_AuvVal6=xtf_pingheader[216:224]
pingheader_Speed=xtf_pingheader[224:232]
pingheader_Turbi=xtf_pingheader[232:240]
pingheader_ShipS=xtf_pingheader[240:248]
pingheader_ShipGyro=xtf_pingheader[248:256]
pingheader_SensorAux=xtf_pingheader[392:400]#唯一一个不为零的地方，但是不知道有什么用
#print(pingheader_SensorAux)


#下面开始解析每一个通道的数据,首先解析通道头，然后根据通道头解析数据
ping_channel1head=data[2560:2688]
channelhead_NumSam=ping_channel1head[84:92]
NumSam1=int((channelhead_NumSam[6:8]+channelhead_NumSam[4:6]+channelhead_NumSam[2:4]+channelhead_NumSam[0:2]),16)
print(NumSam1)
Bytes2=NumSam1*BytesPerSample
ping_channel1Data=data[2688:2688+Bytes2*2]
#print(ping_channel1Data)


b=[]
i=0
for i in range(0,Bytes2*2,4):#先按照小端读取数据尝试读取
    b.append(int((ping_channel1Data[i+2:i+4]+ping_channel1Data[i:i+2]),16))
print(b)
Gmax=max(b)
Gmin=min(b)
print(Gmax)
print(Gmin)
j=0
a=[]
for j in range(0,len(b)-1,1):
    a.append(int((b[j]-Gmin)*255/(Gmax-Gmin)))#将声波强度数据转换为灰度图数据
print(a)
width=len(b)
height=1
# 创建一个新的灰度图像对象
image = Image.new("L", (width, height))

# 将灰度数据赋值给图像的像素
image.putdata(a)

# 显示图像
image.save("test.bmp")
